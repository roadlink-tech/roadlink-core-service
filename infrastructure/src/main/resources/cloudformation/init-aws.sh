#!/bin/bash

#set -euo pipefail

echo "========================================================================================================================="
echo "========================================== Creating Secrets ============================================================="
echo "========================================================================================================================="

# TODO use the following environment variable AWS_DEFAULT_REGION=us-west-2
awslocal ssm put-parameter \
  --name /local/roadlink-core-service/dynamo/credentials \
  --value '{"endpoint":"http://localstack:4566", "region": "us-west-2"}' \
  --type "SecureString"

echo "========================================================================================================================="
echo "======================================= Creating Dynamo Table ==========================================================="
echo "========================================================================================================================="

awslocal cloudformation create-stack \
  --stack-name "user-dynamo-table-stack" \
  --template-body file://user-dynamo-table.yml \
  --region "${AWS_REGION}" \
  --output table

echo "========================================================================================================================="
echo "======================================= Localstack Setup Ends ==========================================================="
echo "========================================================================================================================="
